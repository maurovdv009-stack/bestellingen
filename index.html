<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bestellingen Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #121212;
            color: #ffffff;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #1f1f1f;
            padding: 15px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
        }
        .tab-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
        .tab {
            padding: 10px 20px;
            margin: 0 5px;
            cursor: pointer;
            background-color: #2c2c2c;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .tab.active {
            background-color: #6200ea;
        }
        .tab:hover {
            background-color: #3700b3;
        }
        .content {
            display: none;
            padding: 20px;
        }
        .content.active {
            display: block;
        }
        .orders-table {
            display: block;
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            overflow-x: auto;
            white-space: nowrap;
        }
        .orders-table th, .orders-table td {
            border: 1px solid #333;
            padding: 10px;
            text-align: left;
        }
        .orders-table th {
            background-color: #2c2c2c;
        }
        .btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 2px;
            color: white;
        }
        .btn-refresh {
            background-color: #03dac6;
        }
        .btn-refresh:hover {
            background-color: #018786;
        }
        .btn-delete {
            background-color: #b00020;
        }
        .btn-delete:hover {
            background-color: #7f0000;
        }
        .btn-complete {
            background-color: #018786;
        }
        .btn-complete:hover {
            background-color: #00574b;
        }
        .actions {
            display: flex;
        }
        /* Toast-stijl */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #333;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.4s, transform 0.4s;
            z-index: 1000;
        }
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
        /* Loading spinner */
        .spinner {
            border: 4px solid #2c2c2c;
            border-top: 4px solid #6200ea;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header>
        Bestellingen Dashboard
    </header>
    <div class="tab-container">
        <div class="tab active" data-tab="active-orders">Actieve bestellingen</div>
        <div class="tab" data-tab="history">Geschiedenis</div>
    </div>

    <div id="active-orders" class="content active">
        <button class="btn btn-refresh" onclick="loadOrders()"><i class="fas fa-sync-alt"></i> Vernieuwen</button>
        <div id="orders-list">Laden van bestellingen... <span class="spinner"></span></div>
    </div>
    
    <div id="history" class="content">
        <button class="btn btn-refresh" onclick="loadHistory()"><i class="fas fa-sync-alt"></i> Vernieuwen</button>
        <div id="history-list">Laden van geschiedenis... <span class="spinner"></span></div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        const API_URL_ORDERS = "https://sheetdb.io/api/v1/qd5e58hy4rpvi";
        const API_URL_HISTORY = "https://sheetdb.io/api/v1/dw0r8rjqnxn0t";

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        function showToast(message) {
            const toast = document.getElementById("toast");
            toast.textContent = message;
            toast.classList.add("show");
            setTimeout(() => toast.classList.remove("show"), 3000);
        }

        function convertSheetDate(serial) {
            if (!serial) return "";
            if (typeof serial === "string" && !isNaN(Date.parse(serial))) {
                const d = new Date(serial);
                return `${d.getDate().toString().padStart(2,'0')}/${(d.getMonth()+1).toString().padStart(2,'0')}/${d.getFullYear()}`;
            }
            if (!isNaN(serial)) {
                const d = new Date(Math.round((serial - 25569) * 86400 * 1000));
                return `${d.getDate().toString().padStart(2,'0')}/${(d.getMonth()+1).toString().padStart(2,'0')}/${d.getFullYear()}`;
            }
            return serial;
        }

        async function loadOrders() {
            document.getElementById("orders-list").innerHTML = 'Laden... <span class="spinner"></span>';
            const res = await fetch(API_URL_ORDERS);
            const data = await res.json();
            renderOrders(data, "orders-list", true);
        }

        async function loadHistory() {
            document.getElementById("history-list").innerHTML = 'Laden... <span class="spinner"></span>';
            const res = await fetch(API_URL_HISTORY);
            const data = await res.json();
            renderOrders(data, "history-list", false);
        }

        function renderOrders(data, elementId, isActive) {
            let html = `<table class="orders-table">
                <tr>
                    <th>Naam</th>
                    <th>Email</th>
                    <th>Datum</th>
                    <th>Items</th>
                    ${isActive ? "<th>Acties</th>" : ""}
                </tr>`;
            data.forEach(order => {
                let itemsHtml = "";
                try {
                    const items = JSON.parse(order.Items);
                    itemsHtml = items.map(item =>
                        `<li>${item.name} (${item.quantity} L) - â‚¬${(item.price * item.quantity).toFixed(2).replace('.', ',')}</li>`
                    ).join('');
                } catch {
                    itemsHtml = "<li>Geen items</li>";
                }
                html += `<tr>
                    <td>${order.Naam}</td>
                    <td>${order.Email}</td>
                    <td>${convertSheetDate(order.Datum)}</td>
                    <td><ul>${itemsHtml}</ul></td>
                    ${isActive ? `
                    <td class="actions">
                        <button class="btn btn-complete" onclick="completeOrder('${order.ID}', '${encodeURIComponent(JSON.stringify(order))}')">
                            <i class="fas fa-check"></i> Afmaken
                        </button>
                        <button class="btn btn-delete" onclick="deleteOrder('${order.ID}')">
                            <i class="fas fa-trash"></i> Verwijderen
                        </button>
                    </td>` : ""}
                </tr>`;
            });
            html += "</table>";
            document.getElementById(elementId).innerHTML = html;
        }

        async function deleteOrder(id) {
            await fetch(`${API_URL_ORDERS}/ID/${id}`, { method: "DELETE" });
            showToast("Bestelling verwijderd");
            loadOrders();
        }

        async function completeOrder(id, orderData) {
            const order = JSON.parse(decodeURIComponent(orderData));
            await fetch(API_URL_HISTORY, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify([order])
            });
            await fetch(`${API_URL_ORDERS}/ID/${id}`, { method: "DELETE" });
            showToast("Bestelling verplaatst naar geschiedenis");
            loadOrders();
            loadHistory();
        }

        loadOrders();
    </script>
</body>
</html>
